{% extends "base.html" %}


{% load static %}

{% block header2 %}
<!-- Begin page -->
<div id="layout-wrapper">

    <div class="main-content">

        <div class="page-content">
            <div class="container-fluid">

                <!-- start page title -->
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                            <h4 class="mb-sm-0">DailyTask</h4>

                            <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a href="javascript: void(0);">Dashboard</a></li>
                                    <li class="breadcrumb-item active">DailyTask</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header">

                                <div class="row">
                                    <div class="col-xl-6 col-lg-6 col-md-6 col-12">
                                        <h4>DailyTask Management </h4>
                                    </div>
                                    <div class="col-xl-4 col-lg-4 col-md-4 col-12"></div>
                                    <div class="col-xl-2 col-lg-2 col-md-2 col-12">
                                        <button type="button" class="btn btn-info" style="float:right;"
                                            data-bs-toggle="modal" data-bs-target=".bs-example-modal-lg">+ Add
                                           </button>
                                        <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
                                            aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                            <div class="modal-dialog modal-lg">
                                                <div class="modal-content">
                                                    <form id="createForm" enctype="multipart/form-data">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="myLargeModalLabel">DailyTask
                                                                Details</h5>
                                                            <button type="button" class="btn-close"
                                                                data-bs-dismiss="modal" aria-label="Close"
                                                                onclick="clearErrors()">
                                                            </button>
                                                        </div>
                                                        <hr>
                                                        <div class="modal-body">
                                                            <form id="createForm" enctype="multipart/form-data">
                                                                {% csrf_token %}
                                                                <div class="row">
                                                                    <div class="col-md-6 mt-2">
                                                                        <label for="id_date"
                                                                            class="form-label">Date:</label>
                                                                        <input type="date" name="date"
                                                                            class="form-control" id="date">
                                                                        <span id="dateError"
                                                                            class="error-message"></span>
                                                                    </div>
                                                                    
                                                                    <div class="col-md-6 mt-2">
                                                                        <label for="id_qty"
                                                                            class="form-label">Quantity:</label>
                                                                        <input type="text" name="qty"
                                                                            class="form-control" id="qty">
                                                                        <span id="qtyError"
                                                                            class="error-message"></span>
                                                                    </div>
                                                                    <div class="col-md-6 mt-2">
                                                                        <label for="id_unit"
                                                                            class="form-label">Unit:</label>
                                                                        <select class="form-select" id="unit"
                                                                            name="unit">
                                                                            <option value=""> ------- </option>
                                                                            {% for uom in uoms %}
                                                                            <option value="{{ uom.id }}">{{ uom.name }}</option>
                                                                            
                                                                            {% endfor %}
                                                                        </select>
                                                                        <span id="unitError"
                                                                            class="error-message"></span>
                                                                    </div>
                                                                    <div class="col-md-6 mt-2">
                                                                        <label for="id_project"
                                                                            class="form-label">Project:</label>
                                                                        <select class="form-select" id="project" name="project">
                                                                           
                                                                            <option value=""> ------- </option>
                                                                            {% for i in projects %}
                                                                            <option value="{{ i.id }}">{{i.proj_name }}
                                                                                </option>
                                                                            {% endfor %}
                                                                        </select>
                                                                        <span id="projectError"
                                                                            class="error-message"></span>
                                                                    </div>
                                                                    <div class="col-md-6 mt-2">
                                                                        <label for="id_subcontract" class="form-label">Subcontract:</label>
                                                                        <select class="form-select" id="subcontract" name="subcontract">
                                                                            <option value=""> ------- </option>
                                                                            {% for subcontract in subcontracts %}
                                                                                <option value="{{ subcontract.id }}">{{ subcontract.display_contractor_dropdown }}</option>
                                                                            {% endfor %}
                                                                        </select>
                                                                        <span id="subcontractError" class="error-message"></span>
                                                                    </div>



                                                                <div class="row mt-2">
                                                                        <label for="work_done"
                                                                            class="form-label">Work_done:</label>
                                                                            <textarea name="work_done" class="form-control" id="work_done" rows="4"></textarea>
                                                                        <span id="work_doneError"
                                                                            class="error-message"></span>
                                                                    </div> 
                                                                    
                                                                </div>
                                                            </form>
                                                        </div>
                                                        

                                                        <hr>
                                                        <div class="modal-footer">
                                                            <button
                                                                class="btn btn-link link-success fw-medium shadow-none"
                                                                data-bs-dismiss="modal"><i
                                                                    class="ri-close-line me-1 align-middle"
                                                                    onclick="clearErrors()"></i> Close</button>
                                                            <button type="button" class="btn btn-primary "
                                                                onclick="createFunction(this)">Save </button>
                                                        </div>
                                                    </form>
                                                </div>
                                                <!-- /.modal-content -->
                                            </div>
                                            <!-- /.modal-dialog -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">

                                <div class="row">
                                    {% include "search.html" %}
                                </div>

                                <table id="example"
                                    class="table table-bordered dt-responsive nowrap table-striped align-middle"
                                    style="width:100%">
                                    <thead>
                                        <tr>
                                            <th data-ordering="false">S No.</th>
                                            <th data-ordering="false">Date</th>
                                            <th data-ordering="false">Project</th>
                                            <th data-ordering="false">Subcontract</th>
                                            <!-- <th data-ordering="false">subcontract_items</th> -->
                                            <th data-ordering="false" class="work_done">Work_done</th>
                                            <th data-ordering="false">Qty</th>
                                            <th data-ordering="false">Unit</th>
                                            <th data-ordering="false">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for i in queryset %}
                                        <tr>
                                            <!-- <th scope="row">
                                                    <div class="form-check">
                                                        <input class="form-check-input fs-15" type="checkbox" name="checkAll" value="option1">
                                                    </div>
                                                </th> -->
                                            <td>{{ forloop.counter }}</td>
                                            <td>{{ i.date }}</td>
                                            <td>{{ i.project }}</td>
                                            <td>{{ i.subcontract.display_contractor_dropdown }}</td>
                                            <td>{{ i.work_done }}</td>
                                            <td>{{ i.qty }}</td>
                                            <td>{{ i.unit }}</td>

                                            <td>
                                                <div class="dropdown d-inline-block">
                                                    <button class="btn btn-soft-secondary btn-sm dropdown" type="button"
                                                        data-bs-toggle="dropdown" aria-expanded="false">
                                                        <i class="ri-more-fill align-middle"></i>
                                                    </button>
                                                    <ul class="dropdown-menu dropdown-menu-end">
                                                        <!-- <li><a href="#!" class="dropdown-item view-btn"
                                                                data-bs-toggle="modal"
                                                                data-bs-target="#procatview"><i
                                                                    class="ri-eye-fill align-bottom me-2 text-muted"></i>
                                                                View</a></li> -->
                                                        <li><a class="dropdown-item edit-item-btn"
                                                                data-bs-toggle="modal" href="#!"
                                                                onclick="openModal('viewModal','{{ i.id }}')"><i
                                                                    class="ri-eye-fill align-bottom me-2 text-muted"></i>
                                                                View</a></li>
                                                        <li><a class="dropdown-item edit-item-btn"
                                                                data-bs-toggle="modal" href="#!"
                                                                onclick="openModal('editModal','{{ i.id }}')"><i
                                                                    class="ri-pencil-fill align-bottom me-2 text-muted"></i>
                                                                Edit</a></li>
                                                        <li>
                                                            <a class="dropdown-item remove-item-btn del-btn" href="#!"
                                                                data-target="#deleteModal{{ i.id}}">
                                                                <i
                                                                    class="ri-delete-bin-fill align-bottom me-2 text-muted"></i>
                                                                Delete
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>

                                                <!-- view modal -->


                                                <div class="modal fade" id="viewModal_{{ i.id }}" tabindex="-1"
                                                    aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="myLargeModalLabel">View
                                                                    DailyTask</h5>
                                                                <button type="button" class="btn-close"
                                                                    data-bs-dismiss="modal" aria-label="Close">
                                                                </button>
                                                            </div>
                                                            <hr>
                                                            <div class="modal-body">
                                                                <div class="row">
                                                                    <div class="col-md-6 mt-2">
                                                                        <label for="{{ i.id }}_date"
                                                                            class="form-label">Date
                                                                            :</label>
                                                                        <input type="text" class="form-control"
                                                                            id="{{i.id}}_date" name="date"
                                                                            value="{{i.date}}" disabled />
                                                                    </div>
                                                                    
                                                                    <div class="col-md-6 mt-2">
                                                                        <label for="{{i.id}}_qty"
                                                                            class="form-label">Quantity :</label>
                                                                        <input type="text" class="form-control"
                                                                            id="{{i.id}}_qty" value="{{i.qty}}"
                                                                            disabled />
                                                                    </div>

                                                                    <div class="col-md-6 mt-2">
                                                                        <label for="{{i.id}}_unit"
                                                                            class="form-label">Unit :</label>
                                                                        <input type="text" class="form-control"
                                                                            id="{{i.id}}_unit" value="{{i.unit}}"
                                                                            disabled />
                                                                    </div>

                                                                    <div class="col-md-6 mt-2">
                                                                        <label for="{{i.id}}_project"
                                                                            class="form-label">Project :</label>
                                                                        <input type="text" class="form-control"
                                                                            id="{{i.id}}_project" value="{{i.project}}"
                                                                            disabled />
                                                                    </div>
                                                                    <div class="col-md-6 mt-2">
                                                                        <label for="{{i.id}}_subcontract"
                                                                            class="form-label">subcontract :</label>
                                                                        <input type="text" class="form-control"
                                                                            id="{{i.id}}_subcontract" value="{{i.subcontract.display_contractor_dropdown }}"
                                                                            disabled />
                                                                    </div>
<!-- 
                                                                    <div class="col-md-6 mt-2">
                                                                        <label for="{{i.id}}_subcontract_items"
                                                                            class="form-label">Subcontract Items
                                                                            :</label>
                                                                        <input type="text" class="form-control"
                                                                            id="{{i.id}}_subcontract_items"
                                                                            value="{{i.subcontract_items}}" disabled />
                                                                    </div> -->
                                                                    <div class="row mt-2">
                                                                        <label for="{{i.id}}_work_done"
                                                                            class="form-label">Work Done :</label>
                                                                        <textarea class="form-control"
                                                                            id="{{i.id}}_work_done"
                                                                            disabled>{{i.work_done}}</textarea>
                                                                    </div>



                                                                </div>
                                                            </div>

                                                            <div class="modal-footer mt-3">

                                                            </div>


                                                        </div>
                                                        <!-- /.modal-content -->
                                                    </div>
                                                    <!-- /.modal-dialog -->
                                                </div>



                                                <!-- edit modal -->

                                                <div class="modal fade" id="editModal_{{ i.id }}" tabindex="-1"
                                                    data-bs-keyboard="false" data-bs-backdrop="static" role="dialog"
                                                    aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="editModalLabel">Edit
                                                                    DailyTask</h5>
                                                                <button type="button" class="btn-close"
                                                                    data-bs-dismiss="modal" aria-label="Close"
                                                                    onclick="CloseModel('editModal','{{ i.id }}')"></button>
                                                            </div>
                                                            <hr>
                                                            <div class="modal-body">
                                                                <form id="editForm{{ i.id }}"
                                                                    enctype="multipart/form-data">
                                                                    {% csrf_token %}
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <label for="{{ i.id }}_date">Date:</label>
                                                                            <input type="date" class="form-control"
                                                                                name="date" id="{{ i.id }}_date"
                                                                                value="{{ i.date }}" />
                                                                            <span id="{{i.id}}_dateError"
                                                                                class="error-message"></span>
                                                                        </div>
                                                                       
                                                                        <div class="col-md-6 ">
                                                                            <label
                                                                                for="{{ i.id }}_qty">Quantity:</label>
                                                                            <input type="text" class="form-control"
                                                                                id="{{ i.id }}_qty" name="qty"
                                                                                value="{{ i.qty }}" />
                                                                            <span id="{{i.id}}_qtyError"
                                                                                class="error-message"></span>
                                                                        </div>
                                                                        <div class="col-md-6 mt-2">
                                                                            <label
                                                                                for="{{ i.id }}_unit">Unit:</label>
                                                                            <select class="form-select"
                                                                                id="{{ i.id }}_unit" name="unit">
                                                                                <option value="{{ i.unit.id }}"
                                                                                    selected>{{ i.unit }}</option>
                                                                               
                                                                                {% for uom in uoms %}
                                                                                <option value="{{ uom.id }}">{{ uom.name }}</option>
                                                                                   
                                                                                {% endfor %}
                                                                            </select>
                                                                            <span id="{{i.id}}_unitError"
                                                                                class="error-message"></span>
                                                                        </div>

                                                                        <div class="col-md-6 mt-2">
                                                                            <label
                                                                                for="{{ i.id }}_project">Project:</label>
                                                                            <select class="form-select"
                                                                                id="{{ i.id }}_project" name="project">
                                                                                <option value="{{ i.project.id }}"
                                                                                    selected>{{ i.project }}</option>
                                                                                <option value="" disabled>
                                                                                    ---------------- </option>
                                                                                {% for project in projects %}
                                                                                <option value="{{ project.id }}">{{ project.proj_name }}</option>
                                                                                   
                                                                                {% endfor %}
                                                                            </select>
                                                                            <span id="{{i.id}}_projectError"
                                                                                class="error-message"></span>
                                                                        </div>
                                                                        <div class="col-md-6 mt-2">
                                                                            <label
                                                                                for="{{ i.id }}_subcontract">Subcontract:</label>
                                                                            <select class="form-select"
                                                                                id="{{ i.id }}_subcontract"
                                                                                name="subcontract">
                                                                                <option value="{{ i.subcontract.id }}"
                                                                                    selected>{{ i.subcontract.display_contractor_dropdown }}
                                                                                </option>
                                                                                <option value="" disabled>
                                                                                    ---------------- </option>
                                                                                {% for subcontract in subcontracts %}
                                                                                <option value="{{ subcontract.id }}">{{subcontract.display_contractor_dropdown }}</option>
                                                                                    
                                                                                {% endfor %}
                                                                            </select>
                                                                            <span id="{{i.id}}_subcontractError"
                                                                                class="error-message"></span>
                                                                        </div>
                                                                        <!-- <div class="col-md-6 mt-2">
                                                                            <label
                                                                                for="{{ i.id }}_subcontract_items">Subcontract
                                                                                Items:</label>
                                                                            <select class="form-select"
                                                                                id="{{ i.id }}_subcontract_items"
                                                                                name="subcontract_items">
                                                                                <option
                                                                                    value="{{ i.subcontract_items.id }}"
                                                                                    selected>{{ i.subcontract_items }}
                                                                                </option>
                                                                                <option value="" disabled>
                                                                                    ---------------- </option>
                                                                                {% for item in subcontract_items %}
                                                                                <option value="{{ item.id }}">{{item.name }}
                                                                                    </option>
                                                                                {% endfor %}
                                                                            </select>
                                                                            <span id="{{i.id}}_subcontract_itemsError"
                                                                                class="error-message"></span>
                                                                        </div> -->

                                                                    </div>
                                                                    <div class="row mt-2">
                                                                        <div class="col">
                                                                            <label for="{{ i.id }}_work_done">Work
                                                                                Done:</label>
                                                                            <textarea class="form-control"
                                                                                id="{{ i.id }}_work_done"
                                                                                name="work_done" rows="4">{{ i.work_done }}</textarea>
                                                                            <span id="{{i.id}}_work_doneError"
                                                                                class="error-message"></span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer mt-3">
                                                                        <button type="button" class="btn btn-secondary"
                                                                            data-bs-dismiss="modal"
                                                                            onclick="CloseModel('editModal','{{ i.id }}')">Close</button>
                                                                        <button type="button" class="btn btn-primary"
                                                                            onclick="updateFunction(this,'{{ i.id }}')">Save
                                                                            Changes</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- for delete -->
                                                <div class="modal fade" id="deleteModal{{ i.id }}" tabindex="-1"
                                                    aria-labelledby="deleteModalLabel-{{ forloop.counter }}"
                                                    aria-hidden="true">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title"
                                                                    id="deleteModalLabel-{{ forloop.counter }}">
                                                                    Delete
                                                                    DailyTask</h5>
                                                                <button type="button" class="btn-close"
                                                                    data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p>Are you sure you want to delete
                                                                    "{{ i.project }}"?
                                                                </p>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary"
                                                                    data-bs-dismiss="modal">Cancel</button>
                                                                <button type="button"
                                                                    onclick="deleteFunction(this, '{{ i.id }}')"
                                                                    class="btn btn-danger">Delete</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- ------------------------------------ -->
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>


                                <div class="row">
                                    {% include 'pagination.html' %}
                                </div>


                            </div>
                        </div>
                    </div>
                </div>
                <!-- container-fluid -->
            </div>
            <!-- End Page-content -->

        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->



    <!--start back-to-top-->
    <button onclick="topFunction()" class="btn btn-danger btn-icon" id="back-to-top">
        <i class="ri-arrow-up-line"></i>
    </button>
    <!--end back-to-top-->

    <!--preloader-->
    <div id="preloader">
        <div id="status">
            <div class="spinner-border text-primary avatar-sm" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>


    <script>

        document.addEventListener('DOMContentLoaded', function () {


            const viewButtons = document.querySelectorAll('.view-btn');
            const editButtons = document.querySelectorAll('.edit-btn');
            const delButtons = document.querySelectorAll('.del-btn');

            viewButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const modalId = this.getAttribute('data-target');
                    const modal = document.querySelector(modalId);
                    if (modal) {
                        $(modal).modal('show');
                    }
                });
            });


            editButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const modalId = this.getAttribute('data-target');
                    const modal = document.querySelector(modalId);
                    if (modal) {
                        $(modal).modal('show');
                    }
                });
            });

            delButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const modalId = this.getAttribute('data-target');
                    const modal = document.querySelector(modalId);
                    if (modal) {
                        $(modal).modal('show');
                    }
                });
            });


        });



        // create form

        function createFunction(button) {
            var formId = `createForm`;   //change
            var formElement = document.getElementById(formId);
            try {
                disableButton(button);
                var isValid = true;
                var errors = {};
                var formData = new FormData();

                var requiredKeys = ['date'];   //change


                
                formData.append('date', getValueOrDefault(formElement.querySelector('input[name="date"]').value));
                formData.append('project', getValueOrDefault(formElement.querySelector('select[name="project"]').value));
                formData.append('subcontract', getValueOrDefault(formElement.querySelector('select[name="subcontract"]').value));
                // formData.append('subcontract_items', getValueOrDefault(formElement.querySelector('select[name="subcontract_items"]').value));
                formData.append('work_done', getValueOrDefault(formElement.querySelector('textarea[name="work_done"]').value));
                formData.append('qty', getValueOrDefault(formElement.querySelector('input[name="qty"]').value));
                formData.append('unit', getValueOrDefault(formElement.querySelector('select[name="unit"]').value));


               
                // var attachment = document.querySelector('#createForm input[type="file"]').files[0];
                // if (attachment) {
                //     formData.append("attachment", attachment);
                // }


                requiredKeys.forEach(function (key) {
                    var value = formData.get(key);
                    if (!value.trim()) {
                        isValid = false;
                        errors[key] = ['This field may not be blank.'];
                    }
                });

                if (!isValid) {
                    enableButton(button);
                    console.log(errors);
                    handleCreateErrors(errors);
                    return;
                } else {
                    $(`#${formId} input, #${formId} button`).prop('disabled', true);

                }

                $.ajax({
                    url: '/add_dailytask/',                //change
                    type: 'POST',
                    headers: {
                        'X-CSRFToken': csrftoken,
                    },
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response, status, xhr) {
                        console.error(status);
                        if (xhr.status === 201) {
                            showToast(successMesssage?.message, '', successMesssage?.bgColor, true);
                        } else {
                            console.error(error);
                            restoreForm(formId, button)

                        }
                    },
                    error: function (xhr, status, error) {
                        console.log(xhr, status, error);
                        if (xhr.status === 400) {
                            if (xhr?.responseJSON || xhr?.responseJSON?.errors) {
                                handleCreateErrors(transformErrors(xhr.responseJSON));
                                restoreForm(formId, button)

                            } else {
                                showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                                restoreForm(formId, button)

                            }
                        }
                        else if (xhr.status === 401 || 404) {
                            showToast(xhr?.responseJSON?.details, '', errorAlertMessage?.bgColor);
                            restoreForm(formId, button)

                        }
                        else {
                            showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                            restoreForm(formId, button)

                        }
                    }
                });
            } catch (error) {
                showToast(errorOccured?.message, '', errorOccured?.bgColor);
                restoreForm(formId, button)
                console.error(error);
            }

            finally {
                restoreForm(formId, button)
            }
        }

        // update

        function updateFunction(button, saveId) {

            var formId = `editForm${saveId}`;   //change
            var formElement = document.getElementById(formId);

            var isValid = true;
            var errors = {};


            try {
                disableButton(button);
                clearErrors();

                const formData = new FormData();

                formData.append('date', getValueOrDefault(formElement.querySelector('input[name="date"]').value));
                formData.append('project', getValueOrDefault(formElement.querySelector('select[name="project"]').value));
                formData.append('subcontract', getValueOrDefault(formElement.querySelector('select[name="subcontract"]').value));
                // formData.append('subcontract_items', getValueOrDefault(formElement.querySelector('select[name="subcontract_items"]').value));
                formData.append('work_done', getValueOrDefault(formElement.querySelector('textarea[name="work_done"]').value));
                formData.append('qty', getValueOrDefault(formElement.querySelector('input[name="qty"]').value));
                
                formData.append('unit', getValueOrDefault(formElement.querySelector('select[name="unit"]').value));


                // var attachment = getValueOrDefault(formElement.querySelector('input[type="file"]').files[0]);
                // if (attachment) {
                //     formData.append("attachment", attachment);
                // }


                var requiredKeys = [];     //change

                requiredKeys.forEach(function (key) {
                    var value = formData.get(key);
                    if (!value.trim()) {
                        isValid = false;
                        errors[key] = ['This field may not be blank.'];
                    }
                });

                if (!isValid) {
                    enableButton(button);
                    console.log(errors);
                    handleUpdateErrors(saveId, transformErrors(errors));
                    return;
                } else {
                    $(`#${formId} input, #${formId} button`).prop('disabled', true);

                }


                console.log(csrftoken);
                $.ajax({
                    url: '/update_dailytask/' + saveId + '/',   //change
                    type: 'PUT',
                    headers: {
                        'X-CSRFToken': csrftoken,
                    },
                    processData: false,
                    contentType: false,
                    data: formData,
                    success: function (response, status, xhr) {
                        if (xhr.status === 200) {
                            showToast(updateMessage?.message, '', updateMessage?.bgColor, true);
                            restoreForm(formId, button)
                        } else {
                            showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                            restoreForm(formId, button)

                        }
                    },
                    error: function (xhr, status, error) {
                        console.log(xhr, status, error);
                        if (xhr.status === 400) {
                            if (xhr?.responseJSON || xhr?.responseJSON?.errors) {
                                handleUpdateErrors(saveId, transformErrors(xhr.responseJSON));
                                restoreForm(formId, button)
                            } else {

                                showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                                restoreForm(formId, button)

                            }
                        }
                        else if (xhr.status === 401 || 404) {
                            showToast(xhr?.responseJSON?.details, '', errorAlertMessage?.bgColor);
                            restoreForm(formId, button)

                        }
                        else {

                            showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                            restoreForm(formId, button)

                        }
                    }
                });
            } catch (error) {
                showToast(errorOccured?.message, '', errorOccured?.bgColor);
                restoreForm(formId, button)
                console.error(error);
            }

            finally {
                restoreForm(formId, button)
            }
        }

        //delete form


        function deleteFunction(button, saveId) {
            try {
                disableButton(button);

                $.ajax({
                    url: '/delete_dailytask/' + saveId + '/',
                    type: 'DELETE',
                    headers: {
                        'X-CSRFToken': csrftoken,
                    },
                    processData: false,
                    contentType: false,
                    success: function (response, status, xhr) {
                        if (xhr.status === 204) {
                            showToast(deleteMessage?.message, '', deleteMessage?.bgColor, true);
                            enableButton(button);

                        } else {
                            showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                            enableButton(button);

                        }
                    },
                    error: function (xhr, status, error) {
                        console.log(xhr, status, error);
                        if (xhr.status === 400) {
                            if (xhr?.responseJSON || xhr?.responseJSON?.errors) {
                                showToast(xhr?.responseJSON?.details, '', errorAlertMessage?.bgColor);
                                enableButton(button);
                            } else {
                                showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                                enableButton(button);
                            }
                        }
                        else if (xhr.status === 401 || 404) {
                            showToast(xhr?.responseJSON?.details, '', errorAlertMessage?.bgColor);
                            enableButton(button);
                        }
                        else {

                            showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                            enableButton(button);
                        }
                    }
                });
            } catch (error) {
                showToast(errorOccured?.message, '', errorOccured?.bgColor);
                console.error(error);
            }
            finally {
                enableButton(button);
            }
        }


    </script>

    {% endblock header2 %}