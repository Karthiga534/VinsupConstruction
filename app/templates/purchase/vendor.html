{% extends "base.html" %}
{% load static %}

{% block header2 %}
<!-- Begin page -->
<div id="layout-wrapper">
    <div class="main-content">
        <div class="page-content">
            <div class="container-fluid">
                <!-- start page title -->
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                            <h4 class="mb-sm-0">VENDOR</h4>
                            <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a href="javascript: void(0);">Dashboard</a></li>
                                    <li class="breadcrumb-item active">Vendor Registration</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header">
                                <div class="row">
                                    <div class="col-xl-6 col-lg-6 col-md-6 col-12">
                                        <h3>Vendor List</h3>
                                    </div>
                                    <div class="col-xl-4 col-lg-4 col-md-4 col-12"></div>
                                    <div class="col-xl-2 col-lg-2 col-md-2 col-12">
                                        <button type="button" class="btn btn-info" style="float:right;"
                                            data-bs-toggle="modal" data-bs-target=".bs-example-modal-lg">Add
                                            Vendor</button>
                                        <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
                                            aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                            <div class="modal-dialog modal-lg">
                                                <div class="modal-content">
                                                    <form id="createForm" enctype="multipart/form-data">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="myLargeModalLabel">Add Vendor
                                                            </h5>
                                                            <button type="button" class="btn-close"
                                                                data-bs-dismiss="modal" aria-label="Close"
                                                                onclick="clearErrors()"></button>
                                                        </div>
                                                        <hr>
                                                        <div class="modal-body">
                                                            {% csrf_token %}
                                                            <div class="row">

                                                                <!-- <div class="col-md-6">
                                                                        <label for="id_date" class="form-label">Select Date :</label>
                                                                        <input type="date" name="date" class="form-control" id="date">
                                                                        <span id="dateError" class="error-message" ></span>
                                                                    </div> -->
                                                                <div class="col-md-6">
                                                                    <label for="id_vendorname" class="form-label">Vendor
                                                                        Name :</label>
                                                                    <input type="text" name="vendorname"
                                                                        class="form-control" id="vendorname">
                                                                    <span id="vendornameError"
                                                                        class="error-message"></span>
                                                                </div>
                                                                <div class="col-md-6 mt-2">
                                                                    <label for="id_companyname"
                                                                        class="form-label">Company Name :</label>
                                                                    <input type="text" name="companyname"
                                                                        class="form-control" id="companyname">
                                                                    <span id="companynameError"
                                                                        class="error-message"></span>
                                                                </div>
                                                                <div class="col-md-6 mt-2">
                                                                    <label for="id_gstno" class="form-label">GST No
                                                                        :</label>
                                                                    <input type="text" name="gstno" class="form-control"
                                                                        id="gstno">
                                                                    <span id="gstnoError" class="error-message"></span>
                                                                </div>
                                                                <div class="col-md-6 mt-2">
                                                                    <label for="id_mobile" class="form-label">Phone No
                                                                        :</label>
                                                                    <input type="text" name="mobile"
                                                                        class="form-control" id="mobile">
                                                                    <span id="mobileError" class="error-message"></span>
                                                                </div>
                                                                <div class="col-md-6 mt-2">
                                                                    <label for="id_email" class="form-label">Email
                                                                        :</label>
                                                                    <input type="text" name="email" class="form-control"
                                                                        id="email">
                                                                    <span id="emailError" class="error-message"> </span>
                                                                </div>
                                                                <div class="col-md-6 mt-2">
                                                                    <label for="id_faxno" class="form-label">Fax No
                                                                        :</label>
                                                                    <input type="text" name="faxno" class="form-control"
                                                                        id="faxno">
                                                                    <span id="faxNoError" class="error-message"></span>
                                                                </div>
                                                                <div class="col-md-6 mt-2">
                                                                    <label for="id_address" class="form-label">Address
                                                                        :</label>
                                                                    <textarea class="form-control" name="address"
                                                                        id="address" rows="3"></textarea>
                                                                    <span id="addressError"
                                                                        class="error-message"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <hr>
                                                        <div class="modal-footer">

                                                            <button
                                                                class="btn btn-link link-success fw-medium shadow-none"
                                                                data-bs-dismiss="modal" onclick="clearErrors()">

                                                                <i class="ri-close-line me-1 align-middle"></i>
                                                                Close</button>

                                                            <button type="button" class="btn btn-primary"
                                                                onclick="createFunction(this)">Save </button>

                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card-body">

                                <div class="row">
                                    {% include "search.html" %}
                                </div>


                                <div class="">
                                    <table id="example" class="table table-bordered table-striped align-middle"
                                        style="width:100%">
                                        <thead>
                                            <!-- Table headers -->
                                            <tr>
                                                <th data-ordering="false">SR No.</th>
                                                <th data-ordering="false">Date</th>
                                                <th data-ordering="false">Vendor Name</th>
                                                <th data-ordering="false">Company Name</th>
                                                <th data-ordering="false">GST No</th>
                                                <th data-ordering="false">Phone No</th>
                                                <th data-ordering="false">Email</th>
                                                <th data-ordering="false">Fax No</th>
                                                <th data-ordering="false">Address</th>
                                                <th data-ordering="false">Action</th>

                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for i in queryset %}
                                            <tr>
                                                <td>{{ forloop.counter }}</td>
                                                <td>{{ i.date }}</td>
                                                <td>{{ i.vendorname }}</td>
                                                <td>{{ i.company }}</td>
                                                <td>{{ i.gstno }}</td>
                                                <td>{{ i.mobile }}</td>
                                                <td>{{ i.email }}</td>
                                                <td>{{ i.faxno }}</td>
                                                <td>{{ i.address }}</td>
                                                <td>
                                                    <div class="dropdown d-inline-block">
                                                        <button class="btn btn-soft-secondary btn-sm dropdown"
                                                            type="button" data-bs-toggle="dropdown"
                                                            aria-expanded="false">
                                                            <i class="ri-more-fill align-middle"></i>
                                                        </button>
                                                        <ul class="dropdown-menu dropdown-menu-end">
                                                            <li><a class="dropdown-item" data-id="{{i.id}}" href="#!"
                                                                    onclick="openModal('viewModal', '{{ i.id }}')"><i
                                                                        class="ri-eye-fill align-bottom me-2 text-muted"></i>
                                                                    View</a></li>
                                                            <li><a class="dropdown-item edit-item-btn"
                                                                    data-bs-toggle="modal" href="#!"
                                                                    onclick="openModal('editModal','{{ i.id }}')"><i
                                                                        class="ri-pencil-fill align-bottom me-2 text-muted"></i>
                                                                    Edit</a></li>
                                                            <li>
                                                                <a class="dropdown-item remove-item-btn del-btn"
                                                                    href="#!" data-target="#deleteModal{{ i.id}}">
                                                                    <i
                                                                        class="ri-delete-bin-fill align-bottom me-2 text-muted"></i>
                                                                    Delete
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </div>

                                                    <!-- view modal -->


                                                    <div class="modal fade" id="viewModal_{{i.id}}" tabindex="-1"
                                                        role="dialog" aria-labelledby="viewModalLabel"
                                                        aria-hidden="true" data-bs-backdrop="static"
                                                        data-bs-keyboard="false">

                                                        <div class="modal-dialog modal-lg">

                                                            <div class="modal-content">

                                                                <div class="modal-header">

                                                                    <h5 class="modal-title" id="viewModalLabel">{{i.vendorname}} details</h5>

                                                                    <button type="button" class="btn-close"
                                                                        data-bs-dismiss="modal" aria-label="Close"
                                                                        onclick="CloseModel('viewModal', '{{i.id}}')"></button>

                                                                </div>

                                                                <div class="modal-body">
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <label for="{{i.id}}_date"
                                                                                class="form-label">Date:</label>
                                                                            <input type="text" class="form-control"
                                                                                id="{{i.id}}_date" name="date"
                                                                                value="{{i.date}}" readonly>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <label for="{{i.id}}_vendorname"
                                                                                class="form-label">Vendor Name:</label>
                                                                            <input type="text" class="form-control"
                                                                                id="{{i.id}}_vendorname"
                                                                                name="vendorname"
                                                                                value="{{i.vendorname}}" readonly>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <label for="{{i.id}}_companyname"
                                                                                class="form-label">Company Name:</label>
                                                                            <input type="text" class="form-control"
                                                                                id="{{i.id}}_companyname"
                                                                                name="companyname"
                                                                                value="{{i.companyname}}" readonly>
                                                                        </div>

                                                                        {% comment %} <div class="col-md-6">
                                                                            <label for="{{i.id}}_proj_id"
                                                                                class="form-label">Project Id:</label>
                                                                            <input type="text" class="form-control"
                                                                                id="{{i.id}}_proj_id" name="proj_id"
                                                                                value="{{i.proj_id}}" readonly>
                                                                        </div> {% endcomment %}

                                                                        <div class="col-md-6">
                                                                            <label for="{{i.id}}_gstno"
                                                                                class="form-label">GST No:</label>
                                                                            <input type="text" class="form-control"
                                                                                id="{{i.id}}_gstno" name="gstno"
                                                                                value="{{i.gstno}}" readonly>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <label for="{{i.id}}_mobile"
                                                                                class="form-label">Phone Number:</label>
                                                                            <input type="text" class="form-control"
                                                                                id="{{i.id}}_mobile" name="mobile"
                                                                                value="{{i.mobile}}" readonly>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <label for="{{i.id}}_email"
                                                                                class="form-label">Email:</label>
                                                                            <input type="text" class="form-control"
                                                                                id="{{i.id}}_email" name="email"
                                                                                value="{{i.email}}" readonly>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <label for="{{i.id}}_faxno"
                                                                                class="form-label">Fax No:</label>
                                                                            <input type="text" class="form-control"
                                                                                id="{{i.id}}_faxno" name="faxno"
                                                                                value="{{i.faxno}}" readonly>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <label for="{{i.id}}_address"
                                                                                class="form-label">Address:</label>
                                                                            <input type="text" class="form-control"
                                                                                id="{{i.id}}_address" name="address"
                                                                                value="{{i.address}}" readonly>
                                                                        </div>


                                                                    </div>

                                                                </div>

                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary"
                                                                        data-bs-dismiss="modal"
                                                                        onclick="CloseModel('viewModal', '{{i.id}}')">Close</button>
                                                                </div>

                                                            </div>

                                                        </div>

                                                    </div>


                                                    <!-- edit modal -->

                                                    <div class="modal fade bs-example-modal-lg" tabindex="-1"
                                                        data-bs-keyboard="false" id="editModal_{{i.id}}"
                                                        data-bs-backdrop="static" role="dialog"
                                                        aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                                        <div class="modal-dialog modal-lg">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h5 class="modal-title" id="myLargeModalLabel">{{i.vendorname}} details</h5>
                                                                    <button type="button" class="btn-close"
                                                                        data-bs-dismiss="modal" aria-label="Close"
                                                                        onclick="CloseModel('editModal','{{i.id}}')">
                                                                    </button>
                                                                </div>
                                                                <hr>



                                                                <div class="modal-body">
                                                                    <form id="editForm{{ i.id }}"
                                                                        enctype="multipart/form-data">
                                                                        {% csrf_token %}
                                                                        <div class="row">


                                                                            <div class="col-md-6 mb-3">
                                                                                <label for="editVendorName">Vendor
                                                                                    Name:</label>
                                                                                <input type="text" class="form-control"
                                                                                    name="vendorname"
                                                                                    id="{{i.id}}_vendorname"
                                                                                    value="{{ i.vendorname }}">

                                                                                <span id="{{i.id}}_nameError"
                                                                                    class="error-message"></span>
                                                                            </div>
                                                                            <div class="col-md-6 mb-3">
                                                                                <label for="editCompanyName">Company
                                                                                    Name:</label>
                                                                                <input type="text" class="form-control"
                                                                                    id="{{i.id}}id_companyname"
                                                                                    name="companyname"
                                                                                    value="{{ i.companyname }}">
                                                                                <span id="{{i.id}}_companynameError"
                                                                                    class="error-message"></span>
                                                                            </div>
                                                                            <div class="col-md-6 mb-3">
                                                                                <label for="editEmail">Email:</label>
                                                                                <input type="text" class="form-control"
                                                                                    id="{{i.id}}id_email" name="email"
                                                                                    value="{{ i.email }}">
                                                                                <span id="{{i.id}}_emailError"
                                                                                    class="error-message"></span>
                                                                            </div>
                                                                            <div class="col-md-6 mb-3">
                                                                                <label
                                                                                    for="editaddress">Address:</label>
                                                                                <input type="text" class="form-control"
                                                                                    id="{{i.id}}id_address"
                                                                                    name="address"
                                                                                    value="{{ i.address }}">
                                                                                <span id="{{i.id}}_addressError"
                                                                                    class="error-message"></span>
                                                                            </div>
                                                                            <div class="col-md-6 mb-3">
                                                                                <label for="editmobile">Phone
                                                                                    No:</label>
                                                                                <input type="text" class="form-control"
                                                                                    id="{{i.id}}id_mobile" name="mobile"
                                                                                    value="{{ i.mobile }}">
                                                                                <span id="{{i.id}}_mobileError"
                                                                                    class="error-message"></span>
                                                                            </div>

                                                                            <div class="col-md-6 mb-3">
                                                                                <label for="editFaxno">Fax No:</label>
                                                                                <input type="text" class="form-control"
                                                                                    id="{{i.id}}id_faxno" name="faxno"
                                                                                    value="{{ i.faxno }}">
                                                                                <span id="{{i.id}}_faxnoError"
                                                                                    class="error-message"></span>
                                                                            </div>
                                                                            <div class="col-md-6 mb-3">
                                                                                <label for="editGstno">GST No:</label>
                                                                                <input type="text" class="form-control"
                                                                                    id="{{i.id}}id_gstno" name="gstno"
                                                                                    value="{{ i.gstno }}">
                                                                                <span id="{{i.id}}_gstnoError"
                                                                                    class="error-message"></span>
                                                                            </div>

                                                                            <div class="modal-footer">
                                                                                <button type="button"
                                                                                    class="btn btn-secondary"
                                                                                    data-bs-dismiss="modal"
                                                                                    onclick="CloseModel('editModal','{{i.id}}')">Close</button>
                                                                                <button type="button"
                                                                                    class="btn btn-primary"
                                                                                    onclick="updateFunction(this,'{{i.id}}')">Save
                                                                                    changes</button>
                                                                            </div>
                                                                        </div>
                                                                    </form>


                                                                </div>

                                                            </div>
                                                            <!-- /.modal-content -->
                                                        </div>
                                                        <!-- /.modal-dialog -->
                                                    </div>





                                                    <!-- for delete -->

                                                    <div class="modal fade" id="deleteModal{{ i.id}}" tabindex="-1"
                                                        aria-labelledby="deleteModalLabel-{{ forloop.counter }}"
                                                        aria-hidden="true">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <h5 class="modal-title"
                                                                        id="deleteModalLabel-{{ forloop.counter }}">
                                                                        Delete
                                                                        Role </h5>
                                                                    <button type="button" class="btn-close"
                                                                        data-bs-dismiss="modal"
                                                                        aria-label="Close"></button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <p> Are you sure you want to delete "{{ i.vendorname
                                                                        }}"? </p>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-secondary"
                                                                        data-bs-dismiss="modal"> Cancel </button>


                                                                    <button type="button"
                                                                        onclick="deleteFunction(this,'{{i.id}}')"
                                                                        class="btn btn-danger">Delete</button>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- ------------------------------------ -->


                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                    <div class="row">
                                        {% include 'pagination.html' %}
                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- container-fluid -->
        </div><!-- End Page-content -->
    </div><!-- end main content-->
</div><!-- END layout-wrapper -->



<!--start back-to-top-->
<button onclick="topFunction()" class="btn btn-danger btn-icon" id="back-to-top">
    <i class="ri-arrow-up-line"></i>
</button>
<!--end back-to-top-->

<!--preloader-->
<div id="preloader">
    <div id="status">
        <div class="spinner-border text-primary avatar-sm" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Additional scripts if any -->

<script>


    document.addEventListener('DOMContentLoaded', function () {


        const viewButtons = document.querySelectorAll('.view-btn');
        const editButtons = document.querySelectorAll('.edit-btn');
        const delButtons = document.querySelectorAll('.del-btn');

        viewButtons.forEach(button => {
            button.addEventListener('click', function () {
                const modalId = this.getAttribute('data-target');
                const modal = document.querySelector(modalId);
                if (modal) {
                    $(modal).modal('show');
                }
            });
        });


        editButtons.forEach(button => {
            button.addEventListener('click', function () {
                const modalId = this.getAttribute('data-target');
                const modal = document.querySelector(modalId);
                if (modal) {
                    $(modal).modal('show');
                }
            });
        });

        delButtons.forEach(button => {
            button.addEventListener('click', function () {
                const modalId = this.getAttribute('data-target');
                const modal = document.querySelector(modalId);
                if (modal) {
                    $(modal).modal('show');
                }
            });
        });


    });



    // create form

    function createFunction(button) {
        var formId = `createForm`;   //change
        var formElement = document.getElementById(formId);
        try {
            disableButton(button);
            var isValid = true;
            var errors = {};
            var formData = new FormData();

            var requiredKeys = ['vendorname', 'companyname', 'address', 'mobile', 'gstno', 'faxno', 'email'];   //change


            formData.append('vendorname', getValueOrDefault(formElement.querySelector('input[name="vendorname"]').value));              //change
            //   formData.append('date', getValueOrDefault(formElement.querySelector('input[name="date"]').value));
            formData.append('companyname', getValueOrDefault(formElement.querySelector('input[name="companyname"]').value));
            formData.append('address', getValueOrDefault(formElement.querySelector('textarea[name="address"]').value));
            formData.append('mobile', getValueOrDefault(formElement.querySelector('input[name="mobile"]').value));
            formData.append('gstno', getValueOrDefault(formElement.querySelector('input[name="gstno"]').value));
            formData.append('faxno', getValueOrDefault(formElement.querySelector('input[name="faxno"]').value));
            formData.append('email', getValueOrDefault(formElement.querySelector('input[name="email"]').value));


            //   requiredKeys.forEach(function (key) {
            //       var value = formData.get(key);
            //       if (!value.trim()) {
            //           isl = false;
            //  errorse                'This field may not be blank.'];
            //       }
            //   });

            requiredKeys.forEach(function (key) {
                var value = formData.get(key);
                if (value === null || value === undefined || value === '') {
                    isValid = false;
                    errors[key] = ['This field may not be blank.'];
                } else if (!value.trim()) {
                    isValid = false;
                    errors[key] = ['This field may not be blank.'];
                }
            })


            if (!isValid) {
                enableButton(button);
                console.log(errors);
                handleCreateErrors(errors);
                return;
            } else {
                $(`#${formId} input, #${formId} button`).prop('disabled', true);

            }

            $.ajax({
                url: '/add_vendor/',                //change
                type: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function (response, status, xhr) {
                    console.error(status);
                    if (xhr.status === 201) {
                        showToast(successMesssage?.message, '', successMesssage?.bgColor, true);
                    } else {
                        console.error(error);
                        // restoreForm(formId, button)

                    }
                },
                error: function (xhr, status, error) {
                    console.log(xhr, status, error);
                    if (xhr.status === 400) {
                        if (xhr?.responseJSON || xhr?.responseJSON?.errors) {
                            handleCreateErrors(transformErrors(xhr.responseJSON));
                            // restoreForm(formId, button)

                        } else {
                            showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                            // restoreForm(formId, button)

                        }
                    }
                    else if (xhr.status === 401 || 404) {
                        showToast(xhr?.responseJSON?.details, '', errorAlertMessage?.bgColor);
                        // restoreForm(formId, button)

                    }
                    else {
                        showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                        // restoreForm(formId, button)

                    }
                }
            });
        } catch (error) {
            showToast(errorOccured?.message, '', errorOccured?.bgColor);
            // restoreForm(form, button)
            console.error(error);
        }
        finally{
            restoreForm(form, button)
        }
    }




    // update

    function updateFunction(button, saveId) {

        var formId = `editForm${saveId}`;   //change
        var formElement = document.getElementById(formId);

        var isValid = true;
        var errors = {};


        try {
            disableButton(button);
            clearErrors();

            const formData = new FormData();

            //formData.append('date', getValueOrDefault(formElement.querySelector('input[name="date"]').value));    //change
            formData.append('vendorname', getValueOrDefault(formElement.querySelector('input[name="vendorname"]').value));
            formData.append('companyname', getValueOrDefault(formElement.querySelector('input[name="companyname"]').value));
            formData.append('address', getValueOrDefault(formElement.querySelector('input[name="address"]').value));
            formData.append('mobile', getValueOrDefault(formElement.querySelector('input[name="mobile"]').value));
            formData.append('gstno', getValueOrDefault(formElement.querySelector('input[name="gstno"]').value));
            formData.append('faxno', getValueOrDefault(formElement.querySelector('input[name="faxno"]').value));
            formData.append('email', getValueOrDefault(formElement.querySelector('input[name="email"]').value));


            var requiredKeys = ['vendorname', 'companyname', 'address', 'mobile', 'gstno', 'faxno', 'email'];     //change

            requiredKeys.forEach(function (key) {
                var value = formData.get(key);
                if (!value.trim()) {
                    isValid = false;
                    errors[key] = ['This field may not be blank.'];
                }
            });

            if (!isValid) {
                enableButton(button);
                console.log(errors);
                handleUpdateErrors(saveId, transformErrors(errors));
                return;
            } else {
                $(`#${formId} input, #${formId} button`).prop('disabled', true);

            }


            console.log(csrftoken);
            $.ajax({
                url: '/update_vendor/' + saveId + '/',   //change
                type: 'PUT',
                headers: {
                    'X-CSRFToken': csrftoken,
                },
                processData: false,
                contentType: false,
                data: formData,
                success: function (response, status, xhr) {
                    if (xhr.status === 200) {
                        showToast(updateMessage?.message, '', updateMessage?.bgColor, true);
                        restoreForm(formId, button)
                    } else {
                        showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                        // restoreForm(formId, button)

                    }
                },
                error: function (xhr, status, error) {
                    console.log(xhr, status, error);
                    if (xhr.status === 400) {
                        if (xhr?.responseJSON || xhr?.responseJSON?.errors) {
                            handleUpdateErrors(saveId, transformErrors(xhr.responseJSON));
                            // restoreForm(formId, button)
                        } else {

                            showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                            restoreForm(formId, button)

                        }
                    }
                    else if (xhr.status === 401 || 404) {
                        showToast(xhr?.responseJSON?.details, '', errorAlertMessage?.bgColor);
                        // restoreForm(formId, button)

                    }
                    else {

                        showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                        // restoreForm(formId, button)

                    }
                }
            });
        } catch (error) {
            showToast(errorOccured?.message, '', errorOccured?.bgColor);
            // restoreForm(formId, button)
            console.error(error);
        }
        finally{
            restoreForm(formId, button)
        }
    }








    function deleteFunction(button, saveId) {
        try {
            disableButton(button);

            $.ajax({
                url: '/delete_vendor/' + saveId + '/',
                type: 'DELETE',
                headers: {
                    'X-CSRFToken': csrftoken,
                },
                processData: false,
                contentType: false,
                success: function (response, status, xhr) {
                    if (xhr.status === 204) {
                        showToast(deleteMessage?.message, '', deleteMessage?.bgColor, true);
                        enableButton(button);

                    } else {
                        showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                        enableButton(button);

                    }
                },
                error: function (xhr, status, error) {
                    console.log(xhr, status, error);
                    if (xhr.status === 400) {
                        if (xhr?.responseJSON || xhr?.responseJSON?.errors) {
                            showToast(xhr?.responseJSON?.details, '', errorAlertMessage?.bgColor);
                            enableButton(button);
                        } else {
                            showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                            enableButton(button);
                        }
                    }
                    else if (xhr.status === 401 || 404) {
                        showToast(xhr?.responseJSON?.details, '', errorAlertMessage?.bgColor);
                        enableButton(button);
                    }
                    else {

                        showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                        enableButton(button);
                    }
                }
            });
        } catch (error) {
            showToast(errorOccured?.message, '', errorOccured?.bgColor);
            console.error(error);
        }
        finally{
            enableButton(button);
        }
    }





</script>

{% endblock header2 %}