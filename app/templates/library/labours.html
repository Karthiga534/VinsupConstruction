{% extends "base.html" %}
{% load filters %}
{% load static %}

{% block header2 %}
<div class="main-content">
    <div class="page-content">
        <div class="container-fluid">
            <!-- start page title -->
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                        <h4 class="mb-sm-0"></h4>
                        <div class="page-title-right">
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item"><a href="javascript: void(0);">Dashboard</a></li>
                                <li class="breadcrumb-item active">Labours</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end page title -->
            <!-- end page title 
                    <div class="alert alert-danger" role="alert">
                        This is <strong>Datatable</strong> page in wihch we have used <b>jQuery</b> with cnd link!
                    </div>  -->
            <div class="row card">
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-header">

                            <div class="row">
                                <div class="col-xl-6 col-lg-6 col-md-6 col-12">
                                    <h4>Labours List</h4>
                                </div>
                                <div class="col-xl-4 col-lg-4 col-md-4 col-12"></div>
                                <div class="col-xl-2 col-lg-2 col-md-2 col-12">
                                    <button type="button" class="btn btn-info" style="float:right;"
                                        data-bs-toggle="modal" data-bs-target=".bs-example-modal-lg">+ Add
                                        </button>
                                    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
                                        aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-lg">
                                            <div class="modal-content">
                                                <form id="createForm" enctype="multipart/form-data">

                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="myLargeModalLabel">Labours</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close" onclick="clearErrors()"></button>
                                                    </div>
                                                    <hr>
                                                    <div class="modal-body">
                                                        {% csrf_token %}
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <label for="id_name" class="form-label">Labour
                                                                    Name <span style="color: red;">*</span></label>
                                                                <input type="text" name="name" class="form-control"
                                                                    id="name" value="">
                                                                <span id="nameError" class="error-message"></span>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label for="id_image" class="form-label">Image <span style="color: red;">*</span></label>
                                                                <input type="file" name="image" class="form-control"
                                                                    id="image">
                                                                <span id="imageError" class="error-message "></span>
                                                            </div>
                                                            
                                                            <!-- <div class="mb-3">
                                                                <label for="image" class="form-label">Image:</label>
                                                                <input type="file" name="image" class="form-control" id="image">
                                                                <span id="imageError" class="error-message text-danger"></span>
                                                            </div> -->





                                                            <div class="col-md-6 mb-4">
                                                                <label for="id_role" class="form-label">Role <span style="color: red;">*</span> </label>
                                                                <select class="form-select" id="role" name="role">
                                                                    <option value=""> ------- </option>
                                                                    {% for i in roles %}
                                                                    <option value="{{ i.id }}">{{ i.name }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                                <span id="roleError" class="error-message"></span>
                                                            </div>


                                                            <div class="col-md-6 mb-4">
                                                                <br><label for="id_company_rate"
                                                                    class="form-label mt-3">Company
                                                                    Rate :
                                                                    &nbsp;&nbsp;<input type="checkbox"
                                                                        name="company_rate" class="form-check-input"
                                                                        id="company_rate">
                                                                    <span id="company_rateError"
                                                                        class="error-message"></span></label>
                                                            </div>

                                                            <br>
                                                            <br>
                                                            <hr>


                                                            <div class="col-md-6">
                                                                <label for="id_rate" class="form-label">Rate <span style="color: red;">*</span></label>
                                                                <input type="text" name="rate" class="form-control"
                                                                    id="rate" value="">
                                                                <span id="rateError" class="error-message"></span>
                                                            </div>

                                                            <div class="col-md-6">
                                                                <label for="id_ot_rate" class="form-label">OT
                                                                    Rate <span style="color: red;">*</span></label>
                                                                <input type="text" name="ot_rate" class="form-control"
                                                                    id="ot_rate">
                                                                <span id="ot_rateError" class="error-message"></span>
                                                            </div>

                                                            <div class="col-md-6">
                                                                <label for="id_payment_schedule"
                                                                    class="form-label">Payment schedule <span style="color: red;">*</span></label>
                                                                <select class="form-select" id="payment_schedule"
                                                                    name="payment_schedule">
                                                                    <option value=""> ------- </option>
                                                                    {% for i in payment_schedules %}
                                                                    <option value="{{ i.id }}">{{ i.days }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                                <span id="payment_scheduleError"
                                                                    class="error-message"></span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <hr>

                                                    <div class="modal-footer">
                                                        <button class="btn btn-link link-success fw-medium shadow-none"
                                                            data-bs-dismiss="modal">
                                                            <i class="ri-close-line me-1 align-middle"
                                                                onclick="clearErrors()"></i> Close
                                                        </button>
                                                        <button type="button" class="btn btn-primary"
                                                            onclick="createFunction(this)">Save</button>
                                                    </div>
                                                </form>


                                            </div>
                                        </div>
                                        <hr>

                                        </form>

                                    </div>
                                    <!-- /.modal-content -->
                                </div>
                                <!-- /.modal-dialog -->
                            </div>
                        </div>
                    </div>
                </div>

                
                <div class="card-body">

                    <div class="row">
                        {% include "search.html" %}
                    </div>

                    <table id="example" class="table table-bordered dt-r    esponsive nowrap table-striped align-middle"
                        style="width:100%">
                        <thead>
                            <tr>
                                <!-- <th scope="col" style="width: 10px;">
                                                    <div class="form-check">
                                                        <input class="form-check-input fs-15" type="checkbox" id="checkAll"
                                                            value="option">
                                                    </div>
                                                </th> -->
                                <th data-ordering="false">S.No</th>
                                <th data-ordering="false">Labour Name</th>
                                <th data-ordering="false">Image</th>
                                <th data-ordering="false">Role</th>
                                <th data-ordering="false">Rate</th>
                                <th data-ordering="false">OT Rate</th>
                                <th data-ordering="false"><span> Payment <br> Schedule </span> </th>
                                <th data-ordering="false">Status</th>
                                <th data-ordering="false">Action</th>

                            </tr>
                        </thead>
                        <tbody>
                            {% for i in queryset %}
                            <tr>
                                <!-- <th scope="row">
                                                    <div class="form-check">
                                                        <input class="form-check-input fs-15" type="checkbox" name="checkAll"
                                                            value="{{ category.id }}">
                                                    </div>
                                                </th> -->
                                <td>{{ forloop.counter }}</td>
                                <td>{{ i.name }}</td>
                                <td>
                                    {% if i.image %}
                                        <img src="{{ i.image.url }}" alt="{{ i.image.name }}" class="img-responsive"
                                        style="height:40px;width:40px;" />
                                    {% else %}
                                        No Image
                                    {% endif %}
                                </td>
                                <td>{{ i.role }}</td>
                                <td>{{ i.get_rate}}</td>
                                <td>{{ i.get_ot_rate }}  </td> 
                                <td>{{ i.get_payment_schedule.days }}</td>

                                {% if i.disable == True %}
                        
                                <td class="text-danger" >deactive  </td>
                                
                                {% else %}
                              
                                <td class="text-success"> active  </td>
        
                                {% endif %}


                                <td>
                                    <div class="dropdown d-inline-block">
                                        <button class="btn btn-soft-secondary btn-sm dropdown" type="button"
                                          data-bs-toggle="dropdown" aria-expanded="false">
                                          <i class="ri-more-fill align-middle"></i>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end">
                                          <li><a class="dropdown-item" data-id="{{i.id}}" href="#"
                                              onclick="openModal('viewModal', '{{ i.id }}')"><i
                                                class="ri-eye-fill align-bottom me-2 text-muted"></i> View</a></li>
                                          <li><a class="dropdown-item edit-item-btn" data-id="{{i.id}}" href="#"
                                              onclick="openModal('editModal','{{ i.id }}')"><i
                                                class="ri-pencil-fill align-bottom me-2 text-muted"></i> Edit</a></li>
                                          <li>
                                            <a class="dropdown-item remove-item-btn del-btn" href="#!"
                                              data-target="#deleteModal{{ i.id}}">
                                              {% if i.disable == True %}
            
                                              <i class="ri-delete-bin-fill align-bottom me-2 text-muted"></i>
                                              Enable
                                              {% else %}
                                              
                                              <i class="ri-delete-bin-fill align-bottom me-2 text-muted"></i>
                                              Disable
            
                                              {% endif %}
                                              
                                            </a>
                                          </li>
                                        </ul>
                                      </div>


                                    <!-- <div class="btn-group" role="group">
                                        <button class="btn btn-soft-secondary btn-sm me-2" type="button" data-id="{{i.id}}" onclick="openModal('viewModal', '{{ i.id }}')">
                                            <i class="ri-eye-fill align-bottom me-2 text-muted"></i> View
                                        </button>
                                        <button class="btn btn-primary btn-sm me-2" type="button" data-bs-toggle="modal" onclick="openModal('editModal','{{ i.id }}')">
                                            <i class="ri-pencil-fill align-bottom me-2 text-muted"></i> Edit
                                        </button>
                                        <button class="btn btn-danger btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#deleteModal{{ i.id }}">
                                            <i class="ri-delete-bin-fill align-bottom me-2 text-muted"></i> Delete
                                        </button>
                                    </div> -->

                                    <!-- view modal -->
                                    <div class="modal fade bs-example-modal-lg" id="viewModal_{{ i.id }}" tabindex="-1"
                                        role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-lg">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="myLargeModalLabel">View </h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close">
                                                    </button>
                                                </div>
                                                <hr>
                                                <div class="modal-body">
                                                    <div class="row">
                                                        <div class="col-md-6 mt-2">
                                                            <label for="{{i.id}}_labour_name" class="form-label">Labour
                                                                Name
                                                                :</label>
                                                            <input type="text" class="form-control"
                                                                id="{{i.id}}_labour_name" name="name" value="{{i.name}}"
                                                                disabled />
                                                        </div>



                                                        <div class="col-md-6 mt-2">
                                                            <label for="{{i.id}}_image"
                                                                class="form-label">Image:</label> <br>

                                                            <span class="file-span"> <a target="_blank"
                                                                    href="{{ i.image.url}}">{{i.image |filename }}</a></span>
                                                            <!-- <input type="file" class="form-control" id="{{i.id}}_image"
                                                                name="image " value="{{i.image}}" disabled />
                                                            <a href="{{ i.image}}">{{i.image}}</a> -->
                                                        </div>



                                                        <div class="col-md-6 mt-2">
                                                            <label for="{{i.id}}_role" class="form-label">Role:</label>
                                                            <input type="text" class="form-control" id="{{ i.id }}_role"
                                                                name="role" value="{{ i.role.name }}" disabled />
                                                        </div>

                                                        <div class="col-md-6 mb-4 mt-2">
                                                            <br><label for="id_company_rate"
                                                                class="form-label mt-3">Company
                                                                Rate : 
                                                                &nbsp;&nbsp;<input type="checkbox"
                                                                    name="company_rate" class="form-check-input"
                                                                     {% if i.is_company_rate %} checked {% endif %}
                                                                      disabled
                                                                   >
                                                                <!-- <span id="company_rateError"
                                                                    class="error-message"></span></label> -->
                                                        </div>


                                                        <div class="col-md-6 mt-2">
                                                            <label for="" class="form-label">Rate :</label>
                                                            <input type="text" class="form-control" id=""
                                                                value="{{i.get_rate}}" disabled />
                                                        </div>
                                                        <div class="col-md-6 mt-2">
                                                            <label for="id_ot_rate" class="form-label">OT
                                                                Rate:</label>
                                                            <input type="text" class="form-control" id="id_ot_rate"
                                                                value="{{ i.get_ot_rate }}" disabled>
                                                        </div>
                                                        <div class="col-md-6 mt-2">
                                                            <label for="{{i.id}}_payment_schedule"
                                                                class="form-label">Payment Schedule:
                                                                :</label>
                                                            <input type="text" class="form-control"
                                                                id="{{ i.id}}_payment_schedule" name="payment_schedule"
                                                                value="{{i.get_payment_schedule.days}}" disabled />
                                                        </div>

                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-bs-dismiss="modal">Close</button>
                                                </div>
                                            </div>
                                            <!-- /.modal-content -->
                                        </div>
                                        <!-- /.modal-dialog -->
                                    </div>

                                    <!-- edit modal -->
                                    <div class="modal fade bs-example-modal-lg" tabindex="-1" data-bs-keyboard="false"
                                        id="editModal_{{i.id}}" data-bs-backdrop="static" role="dialog"
                                        aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-lg">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="editModalLabel">Edit </h5>


                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close" onclick="CloseModel('editModal','{{i.id}}')">
                                                    </button>
                                                </div>
                                                <hr>

                                                <div class="modal-body">
                                                    <form id="editForm{{ i.id }}" enctype="multipart/form-data">
                                                        {% csrf_token %}
                                                        <div class="row">
                                                            <div class="col-md-6 mt-2">
                                                                <label for="editCompanyName">Labour
                                                                    Name:</label>
                                                                <input type="text" class="form-control" name="name"
                                                                    id="{{i.id}}_name" value="{{ i.name }}">
                                                                <span id="{{i.id}}_nameError"
                                                                    class="error-message"></span>
                                                            </div>

                                                            <div class="col-md-6 mt-2">
                                                                <label for="{{ i.id }}_attachment">Image:</label>
                                                                 <span
                                                                    class="file-span">
                                                                    <a target="_blank" href="{{ i.image.url}}">{{i.image  |filename }}</a></span>
                                                           
                                                                <input type="file" class="form-control"
                                                                    id="{{ i.id }}_image" name="image"
                                                                    value="{{ i.image }}" readonly>

                                                                </div>

                                                                <!-- <span id="{{i.id}}_imageError"
                                                                    class="error-message"></span>
                                                                <a href="{{ i.image }}">{{i.image}}</a> -->


                                                                <div class="col-md-6 mt-2">
                                                                    <label for="{{ i.id }}_role">Role:</label>
                                                                    <select class="form-select" id="{{ i.id }}_role"
                                                                        name="role">
                                                                        <span id="{{i.id}}_roleError"
                                                                            class="error-message"></span>
                                                                        <option value="{{i.role.id}}" selected>
                                                                            {{i.role.name}}</option>
                                                                        <option value="" disabled>---------------
                                                                        </option>
                                                                        {% for i in roles %}
                                                                        <option value="{{ i.id }}">{{ i.name }}</option>
                                                                        {% endfor %}
                                                                    </select>
                                                                </div>


                                                                <div class="col-md-6 mb-4">
                                                                    <br><label for="id_company_rate"
                                                                        class="form-label mt-3">Company
                                                                        Rate : 
                                                                        &nbsp;&nbsp;<input type="checkbox"
                                                                            id="{{i.id}}_company_rate" name="company_rate" class="form-check-input"
                                                                             {% if i.is_company_rate %} checked {% endif %}
                                                                             
                                                                           >
                                                                           <span id="{{i.id}}_company_rateError"
                                                                           class="error-message"></span>
                                                                </div>


                                                                <hr>
                                                           
                                                            <div class="col-md-6 mt-2">
                                                                <label for="editrate">Rate:</label>
                                                                <input type="text" class="form-control"
                                                                    id="{{i.id}}_rate" name="rate" value="{{ i.rate}}">
                                                                <span id="{{i.id}}_rateError"
                                                                    class="error-message"></span>
                                                            </div>

                                                            <div class="col-md-6 mt-2">
                                                                <label for="editot_rate">OT Rate:</label>
                                                                <input type="text" class="form-control"
                                                                    id="{{ i.id }}_ot_rate" name="ot_rate"
                                                                    value="{{ i.ot_rate }}">
                                                                <span id="{{ i.id }}_ot_rateError"
                                                                    class="error-message"></span>
                                                            </div>

                                                            <div class="col-md-6 mt-2">
                                                                <label for="{{ i.id }}_payment_schedule">Payment
                                                                    Schedule:</label>
                                                                <select class="form-select"
                                                                    id="{{ i.id }}_payment_schedule"
                                                                    name="payment_schedule">
                                                                    <span id="{{ i.id }}_payment_scheduleError"
                                                                        class="error-message"></span>
                                                                    <option value="{{ i.get_payment_schedule.id }}"
                                                                        selected>{{ i.get_payment_schedule.days }}
                                                                    </option>
                                                                    <option value="" disabled>----------------
                                                                    </option>
                                                                    {% for i in payment_schedules %}
                                                                    <option value="{{ i.id }}">{{ i.days }}
                                                                    </option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>

                                                           

                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary"
                                                                    data-bs-dismiss="modal"
                                                                    onclick="CloseModel('editModal','{{i.id}}')">Close</button>
                                                                <button type="button" class="btn btn-primary"
                                                                    onclick="updateFunction(this,'{{i.id}}')">Save
                                                                    changes</button>
                                                            </div>
                                                        </div>

                                                    </form>

                                                </div>


                                            </div>
                                            <!-- /.modal-content -->
                                        </div>
                                        <!-- /.modal-dialog -->
                                    </div>

                                    <!-- for delete -->
                                    <!-- <div class="modal fade" id="deleteModal{{ i.id}}" tabindex="-1"
                                        aria-labelledby="deleteModalLabel-{{ forloop.counter }}" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="deleteModalLabel-{{ forloop.counter }}">
                                                        Delete Role </h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <p> Are you sure you want to delete "{{ i.name }}"? </p>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-bs-dismiss="modal"> Cancel </button>
                                                    <button type="button" onclick="deleteFunction(this,'{{i.id}}')"
                                                        class="btn btn-danger">Delete</button>

                                                </div>
                                            </div>
                                        </div>
                                    </div> -->


                                    <div class="modal fade" id="deleteModal{{ i.id}}" tabindex="-1"
                                    aria-labelledby="deleteModalLabel-{{ forloop.counter }}" aria-hidden="true">
                                    <div class="modal-dialog">
                                      <div class="modal-content">
                                        <div class="modal-header">
                                          <h5 class="modal-title" id="deleteModalLabel-{{ forloop.counter }}"> 
                                            {{i.name}}</h5>
                                          <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                        </div>
                                        {% if i.disable == True %}
        
                                        <div class="modal-body">
                                          <p> Are you sure you want to Enable "{{ i.name }}"? </p>
                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                                            onclick="CloseModel('editModal','{{i.id}}')">Close</button>
        
                                          <button type="button" onclick="deleteFunction(this,'{{i.id}}')"
                                            class="btn btn-success">Enable</button>
        
                                        </div>
                                        {% else %}
        
                                        <div class="modal-body">
                                          <p> Are you sure you want to disable "{{ i.name }}"? </p>
                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                                            onclick="CloseModel('editModal','{{i.id}}')">Close</button>
        
                                          <button type="button" onclick="deleteFunction(this,'{{i.id}}')"
                                            class="btn btn-danger">Disable</button>
        
                                        </div>
                                        
                                      
        
                                        {% endif %}
                                       
                                      </div>
                                    </div>
                                  </div>
                                    <!-- ------------------------------------ -->


                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>


                    <div class="row">
                        {% include 'pagination.html' %}
                    </div>


                </div>
            </div>
        </div>
    </div>
    <!-- container-fluid -->
</div>
<!-- End Page-content -->

</div>
<!-- end main content-->

</div>
<!-- END layout-wrapper -->



<!--start back-to-top-->
<button onclick="topFunction()" class="btn btn-danger btn-icon" id="back-to-top">
    <i class="ri-arrow-up-line"></i>
</button>
<!--end back-to-top-->

<!--preloader-->
<div id="preloader">
    <div id="status">
        <div class="spinner-border text-primary avatar-sm" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
</div>


<script>


    document.addEventListener('DOMContentLoaded', function () {


        const viewButtons = document.querySelectorAll('.view-btn');
        const editButtons = document.querySelectorAll('.edit-btn');
        const delButtons = document.querySelectorAll('.del-btn');

        viewButtons.forEach(button => {
            button.addEventListener('click', function () {
                const modalId = this.getAttribute('data-target');
                const modal = document.querySelector(modalId);
                if (modal) {
                    $(modal).modal('show');
                }
            });
        });


        editButtons.forEach(button => {
            button.addEventListener('click', function () {
                const modalId = this.getAttribute('data-target');
                const modal = document.querySelector(modalId);
                if (modal) {
                    $(modal).modal('show');
                }
            });
        });

        delButtons.forEach(button => {
            button.addEventListener('click', function () {
                const modalId = this.getAttribute('data-target');
                const modal = document.querySelector(modalId);
                if (modal) {
                    $(modal).modal('show');
                }
            });
        });


    });



    // create form

    function createFunction(button) {
        var formId = `createForm`;   //change
        var formElement = document.getElementById(formId);
        try {
            disableButton(button);
            var isValid = true;
            var errors = {};
            var formData = new FormData();

            var requiredKeys = ['name', 'image', 'role', 'rate', 'ot_rate', 'payment_schedule','company_rate'];

            company_rate = getValueOrDefault(formElement.querySelector('input[name="company_rate"]').checked)
            ot_rate = getValueOrDefault(formElement.querySelector('input[name="ot_rate"]').value)
            rate = getValueOrDefault(formElement.querySelector('input[name="rate"]').value)
            paymentSchedule = getValueOrDefault(formElement.querySelector('select[name="payment_schedule"]').value)
            image = getValueOrDefault(formElement.querySelector('input[name="image"]').value)

            formData.append('name', getValueOrDefault(formElement.querySelector('input[name="name"]').value));
            formData.append('role', getValueOrDefault(formElement.querySelector('select[name="role"]').value));

            formData.append('company_rate', company_rate);

            if (image) {
                formData.append('image', image);
            }
            // if (company_rate) {
            //     formData.append('company_rate', company_rate);
            // }
            if (rate) {
                formData.append('rate', rate);
            }

            if (ot_rate) {
                formData.append('ot_rate', ot_rate);
            }

            if (paymentSchedule) {
                formData.append('payment_schedule', paymentSchedule);

            }

            if (company_rate) {
                var requiredKeys = ['name', 'image', 'role'];
            }



            // company_rate

            var image = document.querySelector('#createForm input[type="file"]').files[0];
            if (image) {
                formData.append("image", image);
            }


            // requiredKeys.forEach(function (key) {
            //     var value = formData.get(key);
            //     if (!value.trim()) {
            //         isValid = false;
            //         errors[key] = ['This field may not be blank.'];
            //     }
            // });

            requiredKeys.forEach(function (key) {
                var value = formData.get(key);
                if (value === null || value === undefined || value === '') {
                    isValid = false;
                    errors[key] = ['This field may not be blank.'];
                } else if (!value.trim()) {
                    isValid = false;
                    errors[key] = ['This field may not be blank.'];
                }
            })



            if (!isValid) {
                enableButton(button);
                console.log(errors);
                handleCreateErrors(errors);
                return;
            } else {
                $(`#${formId} input, #${formId} button`).prop('disabled', true);

            }

            $.ajax({
                url: '/add_labours/',                //change
                type: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                },
                data: formData,
                processData: false,
                contentType: false,
                success: function (response, status, xhr) {
                    console.error(status);
                    if (xhr.status === 201) {
                        showToast(successMesssage?.message, '', successMesssage?.bgColor, true);
                    } else {
                        console.error(error);
                        restoreForm(formId, button)

                    }
                },
                error: function (xhr, status, error) {
                    console.log(xhr, status, error);
                    if (xhr.status === 400) {
                        if (xhr?.responseJSON || xhr?.responseJSON?.errors) {
                            handleCreateErrors(transformErrors(xhr.responseJSON));
                            restoreForm(formId, button)

                        } else {
                            showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                            restoreForm(formId, button)

                        }
                    }
                    else if (xhr.status === 401 || 404) {
                        showToast(xhr?.responseJSON?.details, '', errorAlertMessage?.bgColor);
                        restoreForm(formId, button)

                    }
                    else {
                        showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                        restoreForm(formId, button)

                    }
                }
            });
        } catch (error) {
            showToast(errorOccured?.message, '', errorOccured?.bgColor);
            restoreForm(formId, button)
            console.error(error);
        }
    }




    // update

    function updateFunction(button, saveId) {

        var formId = `editForm${saveId}`;   //change
        var formElement = document.getElementById(formId);

        var isValid = true;
        var errors = {};


        try {
            disableButton(button);
            clearErrors();

            const formData = new FormData();


            var requiredKeys = ['name', 'image', 'role', 'rate', 'ot_rate', 'payment_schedule','company_rate'];

            company_rate = getValueOrDefault(formElement.querySelector('input[name="company_rate"]').checked)
            ot_rate = getValueOrDefault(formElement.querySelector('input[name="ot_rate"]').value)
            rate = getValueOrDefault(formElement.querySelector('input[name="rate"]').value)
            paymentSchedule = getValueOrDefault(formElement.querySelector('select[name="payment_schedule"]').value)
            image = getValueOrDefault(formElement.querySelector('input[name="image"]').value)

            formData.append('name', getValueOrDefault(formElement.querySelector('input[name="name"]').value));
            formData.append('role', getValueOrDefault(formElement.querySelector('select[name="role"]').value));

            formData.append('company_rate', company_rate);

            if (image) {
                formData.append('image', image);
            }
            // if (company_rate) {
            //     formData.append('company_rate', company_rate);
            // }
            if (rate) {
                formData.append('rate', rate);
            }

            if (ot_rate) {
                formData.append('ot_rate', ot_rate);
            }

            if (paymentSchedule) {
                formData.append('payment_schedule', paymentSchedule);

            }

            if (company_rate) {
                var requiredKeys = ['name', 'image', 'role'];
            }

            // formData.append('name', getValueOrDefault(formElement.querySelector('input[name="name"]').value));    //change
            // formData.append('rate', getValueOrDefault(formElement.querySelector('input[name="rate"]').value));
            // formData.append('role', getValueOrDefault(formElement.querySelector('select[name="role"]').value));
            // // formData.append('image', getValueOrDefault(formElement.querySelector('input[name="image"]').value));

            // formData.append('ot_rate', getValueOrDefault(formElement.querySelector('input[name="ot_rate"]').value));
            // formData.append('payment_schedule', getValueOrDefault(formElement.querySelector('select[name="payment_schedule"]').value))


            // const companyRateCheckbox = formElement.querySelector('input[name="company_rate"]');
            //const companyRateValue = companyRateCheckbox.checked;
            //formData.append('company_rate', companyRateValue ? 'true' : 'false');

            var image = getValueOrDefault(formElement.querySelector('input[type="file"]').files[0]);
            if (image) {
                formData.append("image", image);
            }


            var requiredKeys = [];     //change

            // requiredKeys.forEach(function (key) {
            //     var value = formData.get(key);
            //     if (!value.trim()) {
            //         isValid = false;
            //         errors[key] = ['This field may not be blank.'];
            //     }
            // });



            requiredKeys.forEach(function (key) {
                var value = formData.get(key);
                if (value === null || value === undefined || value === '') {
                    isValid = false;
                    errors[key] = ['This field may not be blank.'];
                } else if (!value.trim()) {
                    isValid = false;
                    errors[key] = ['This field may not be blank.'];
                }
            })

            if (!isValid) {
                enableButton(button);
                console.log(errors);
                handleUpdateErrors(saveId, transformErrors(errors));
                return;
            } else {
                $(`#${formId} input, #${formId} button`).prop('disabled', true);

            }


            console.log(csrftoken);
            $.ajax({
                url: '/update_labours/' + saveId + '/',   //change
                type: 'PUT',
                headers: {
                    'X-CSRFToken': csrftoken,
                },
                processData: false,
                contentType: false,
                data: formData,
                success: function (response, status, xhr) {
                    if (xhr.status === 200) {
                        showToast(updateMessage?.message, '', updateMessage?.bgColor, true);
                        restoreForm(formId, button)
                    } else {
                        showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                        restoreForm(formId, button)

                    }
                },
                error: function (xhr, status, error) {
                    console.log(xhr, status, error);
                    if (xhr.status === 400) {
                        if (xhr?.responseJSON || xhr?.responseJSON?.errors) {
                            handleUpdateErrors(saveId, transformErrors(xhr.responseJSON));
                            restoreForm(formId, button)
                        } else {

                            showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                            restoreForm(formId, button)

                        }
                    }
                    else if (xhr.status === 401 || 404) {
                        showToast(xhr?.responseJSON?.details, '', errorAlertMessage?.bgColor);
                        restoreForm(formId, button)

                    }
                    else {

                        showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                        restoreForm(formId, button)

                    }
                }
            });
        } catch (error) {
            showToast(errorOccured?.message, '', errorOccured?.bgColor);
            restoreForm(formId, button)
            console.error(error);
        }

        finally{
            restoreForm(formId, button)
        }
    }


    // delete function
    function deleteFunction(button, saveId) {

        var stat_message = {"true" :'Disabled'  , "false" : "Enabled" }

        try {
            disableButton(button);

            $.ajax({
                url: '/delete_labours/' + saveId + '/',
                type: 'DELETE',
                headers: {
                    'X-CSRFToken': csrftoken,
                },
                processData: false,
                contentType: false,
                success: function (response, status, xhr) {
                    if (xhr.status === 200) {
                        const status = xhr?.responseJSON?.details?.pop()
                        
                        showToast(stat_message[status] + ' successfully', '', deleteMessage?.bgColor, true);
                        enableButton(button);

                    } else {
                        showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                        enableButton(button);

                    }
                },
                error: function (xhr, status, error) {
                    console.log(xhr, status, error);
                    if (xhr.status === 400) {
                        if (xhr?.responseJSON || xhr?.responseJSON?.errors) {
                            showToast(xhr?.responseJSON?.details, '', errorAlertMessage?.bgColor);
                            // enableButton(button);
                        } else {
                            showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                            // enableButton(button);
                        }
                    }
                    else if (xhr.status === 401 || 404) {
                        showToast(xhr?.responseJSON?.details, '', errorAlertMessage?.bgColor);
                        // enableButton(button);
                    }
                    else {

                        showToast(errorAlertMessage?.message, '', errorAlertMessage?.bgColor);
                        // enableButton(button);
                    }
                }
            });
        } catch (error) {
            showToast(errorOccured?.message, '', errorOccured?.bgColor);
            console.error(error);
        }
        finally{
            enableButton(button); 
        }
    }

</script>

{% endblock header2 %}